import unittest
import main
from pathlib import Path


class TestFeed(unittest.TestCase):
    exemple_free_bikes = {
        "902606c04933d5c85a8a4fcfffd222c4": {
            "is_reserved": 0,
            "bike_id": "902606c04933d5c85a8a4fcfffd222c4",
            "type": "electric_bike",
            "lat": 39.9690315,
            "name": "902606c04933d5c85a8a4fcfffd222c4",
            "is_disabled": 0,
            "lon": -82.999674,
            "rental_uris": {
                "android": "https://lyft.com/lastmile_qr_scan",
                "ios": "https://lyft.com/lastmile_qr_scan",
            },
        },
        "dd2f4729320a56162dd760bb6edd82cd": {
            "is_reserved": 0,
            "bike_id": "dd2f4729320a56162dd760bb6edd82cd",
            "type": "electric_bike",
            "lat": 39.9690745,
            "name": "dd2f4729320a56162dd760bb6edd82cd",
            "is_disabled": 0,
            "lon": -83.00050666666667,
            "rental_uris": {
                "android": "https://lyft.com/lastmile_qr_scan",
                "ios": "https://lyft.com/lastmile_qr_scan",
            },
        },
        "ccfb9b0a95f6445fa6eeb293a876a168": {
            "is_reserved": 0,
            "bike_id": "ccfb9b0a95f6445fa6eeb293a876a168",
            "type": "electric_bike",
            "lat": 39.9873685,
            "name": "ccfb9b0a95f6445fa6eeb293a876a168",
            "is_disabled": 0,
            "lon": -83.02300433333333,
            "rental_uris": {
                "android": "https://lyft.com/lastmile_qr_scan",
                "ios": "https://lyft.com/lastmile_qr_scan",
            },
        },
        "0e9f170ac1207ac4695066c4bd320c31": {
            "is_reserved": 0,
            "bike_id": "0e9f170ac1207ac4695066c4bd320c31",
            "type": "electric_bike",
            "lat": 39.967627666666665,
            "name": "0e9f170ac1207ac4695066c4bd320c31",
            "is_disabled": 0,
            "lon": -83.0072515,
            "rental_uris": {
                "android": "https://lyft.com/lastmile_qr_scan",
                "ios": "https://lyft.com/lastmile_qr_scan",
            },
        },
        "a0d2923aeabfa74fa7efdbb81af6d7b5": {
            "is_reserved": 0,
            "bike_id": "a0d2923aeabfa74fa7efdbb81af6d7b5",
            "type": "electric_bike",
            "lat": 39.9575575,
            "name": "a0d2923aeabfa74fa7efdbb81af6d7b5",
            "is_disabled": 0,
            "lon": -83.00071033333333,
            "rental_uris": {
                "android": "https://lyft.com/lastmile_qr_scan",
                "ios": "https://lyft.com/lastmile_qr_scan",
            },
        },
        "efe948758cec1ce3d789c2a536364d47": {
            "is_reserved": 0,
            "bike_id": "efe948758cec1ce3d789c2a536364d47",
            "type": "electric_bike",
            "lat": 39.95272416666667,
            "name": "efe948758cec1ce3d789c2a536364d47",
            "is_disabled": 0,
            "lon": -82.97675433333333,
            "rental_uris": {
                "android": "https://lyft.com/lastmile_qr_scan",
                "ios": "https://lyft.com/lastmile_qr_scan",
            },
        },
        "4b343d62b5d2b6c8ba30ffcc9ca9f583": {
            "is_reserved": 0,
            "bike_id": "4b343d62b5d2b6c8ba30ffcc9ca9f583",
            "type": "electric_bike",
            "lat": 39.9990445,
            "name": "4b343d62b5d2b6c8ba30ffcc9ca9f583",
            "is_disabled": 0,
            "lon": -83.01734666666667,
            "rental_uris": {
                "android": "https://lyft.com/lastmile_qr_scan",
                "ios": "https://lyft.com/lastmile_qr_scan",
            },
        },
        "57655756aea1090bedd9539315c4c415": {
            "is_reserved": 0,
            "bike_id": "57655756aea1090bedd9539315c4c415",
            "type": "electric_bike",
            "lat": 39.9774015,
            "name": "57655756aea1090bedd9539315c4c415",
            "is_disabled": 0,
            "lon": -83.01164883333334,
            "rental_uris": {
                "android": "https://lyft.com/lastmile_qr_scan",
                "ios": "https://lyft.com/lastmile_qr_scan",
            },
        },
        "e0a9c2aba70c2b9b66134b6f9da46b87": {
            "is_reserved": 0,
            "bike_id": "e0a9c2aba70c2b9b66134b6f9da46b87",
            "type": "electric_bike",
            "lat": 39.99114216666667,
            "name": "e0a9c2aba70c2b9b66134b6f9da46b87",
            "is_disabled": 0,
            "lon": -83.006453,
            "rental_uris": {
                "android": "https://lyft.com/lastmile_qr_scan",
                "ios": "https://lyft.com/lastmile_qr_scan",
            },
        },
        "7939d8e3f69110eeb4c712dcbc5a2db4": {
            "is_reserved": 0,
            "bike_id": "7939d8e3f69110eeb4c712dcbc5a2db4",
            "type": "electric_bike",
            "lat": 39.98730466666667,
            "name": "7939d8e3f69110eeb4c712dcbc5a2db4",
            "is_disabled": 0,
            "lon": -83.02291116666666,
            "rental_uris": {
                "android": "https://lyft.com/lastmile_qr_scan",
                "ios": "https://lyft.com/lastmile_qr_scan",
            },
        },
        "9d77c9b9158151845b63e3deee5ea67d": {
            "is_reserved": 0,
            "bike_id": "9d77c9b9158151845b63e3deee5ea67d",
            "type": "electric_bike",
            "lat": 39.96899166666667,
            "name": "9d77c9b9158151845b63e3deee5ea67d",
            "is_disabled": 0,
            "lon": -82.999581,
            "rental_uris": {
                "android": "https://lyft.com/lastmile_qr_scan",
                "ios": "https://lyft.com/lastmile_qr_scan",
            },
        },
        "e4613309780073a7fbd99ca95b4d0a4e": {
            "is_reserved": 0,
            "bike_id": "e4613309780073a7fbd99ca95b4d0a4e",
            "type": "electric_bike",
            "lat": 39.949966333333336,
            "name": "e4613309780073a7fbd99ca95b4d0a4e",
            "is_disabled": 0,
            "lon": -82.9568525,
            "rental_uris": {
                "android": "https://lyft.com/lastmile_qr_scan",
                "ios": "https://lyft.com/lastmile_qr_scan",
            },
        },
        "49b79c78a274b6b7391affc07bb94e3a": {
            "is_reserved": 0,
            "bike_id": "49b79c78a274b6b7391affc07bb94e3a",
            "type": "electric_bike",
            "lat": 40.00916183333333,
            "name": "49b79c78a274b6b7391affc07bb94e3a",
            "is_disabled": 0,
            "lon": -83.01368066666667,
            "rental_uris": {
                "android": "https://lyft.com/lastmile_qr_scan",
                "ios": "https://lyft.com/lastmile_qr_scan",
            },
        },
        "7b73b3115d38886be8943543a19114f3": {
            "is_reserved": 0,
            "bike_id": "7b73b3115d38886be8943543a19114f3",
            "type": "electric_bike",
            "lat": 39.961820333333335,
            "name": "7b73b3115d38886be8943543a19114f3",
            "is_disabled": 0,
            "lon": -82.96551716666667,
            "rental_uris": {
                "android": "https://lyft.com/lastmile_qr_scan",
                "ios": "https://lyft.com/lastmile_qr_scan",
            },
        },
    }

    example_stations = [
        (
            "d63c5761-3168-11ea-a9c2-021785291289",
            -83.0083875,
            40.001107,
            "High St & 17th Ave",
            "",
        ),
        (
            "d63bbed4-3168-11ea-a9c2-021785291289",
            -83.001536,
            39.965888,
            "High St & Spring St",
            "",
        ),
        (
            "d63bf2e6-3168-11ea-a9c2-021785291289",
            -82.9908445,
            39.961557,
            "Library - Main Branch",
            "",
        ),
        (
            "d63b84f1-3168-11ea-a9c2-021785291289",
            -82.998983,
            39.9546,
            "Dorrian Commons - Mound St",
            "",
        ),
        (
            "d63d0344-3168-11ea-a9c2-021785291289",
            -83.039975,
            39.9847325,
            "Northwest Blvd & 3rd Ave",
            "",
        ),
        (
            "d63be971-3168-11ea-a9c2-021785291289",
            -82.990458,
            39.9651575,
            "Columbus College of Art & Design",
            "",
        ),
        (
            "d63cfeb5-3168-11ea-a9c2-021785291289",
            -83.0087715,
            39.964999,
            "North Bank Park",
            "",
        ),
        (
            "d63abbf5-3168-11ea-a9c2-021785291289",
            -83.0032215,
            39.955924,
            "Bicentennial Park",
            "",
        ),
        (
            "d63cf037-3168-11ea-a9c2-021785291289",
            -83.000232,
            40.0146755,
            "Summit St & Hudson St",
            "",
        ),
        (
            "d63b9a40-3168-11ea-a9c2-021785291289",
            -82.998107,
            39.957608,
            "Columbus Commons - Rich St",
            "",
        ),
        (
            "d63cf544-3168-11ea-a9c2-021785291289",
            -82.9617595,
            39.9679915,
            "Taylor Ave & Long St",
            "",
        ),
        (
            "d63caf6c-3168-11ea-a9c2-021785291289",
            -83.067873,
            40.013509,
            "Tremont Center at Tremont Rd",
            "",
        ),
        (
            "d63cfa01-3168-11ea-a9c2-021785291289",
            -82.953245,
            39.963267,
            "Franklin Park at Fairwood Ave",
            "",
        ),
        (
            "d63b9ede-3168-11ea-a9c2-021785291289",
            -82.995355,
            39.949433,
            "3rd St & Sycamore St",
            "",
        ),
        (
            "d63bdf89-3168-11ea-a9c2-021785291289",
            -83.004787,
            39.982784,
            "High St & 2nd Ave",
            "",
        ),
        (
            "d63bd5ab-3168-11ea-a9c2-021785291289",
            -83.0115745,
            39.9774165,
            "Neil Ave & Buttles Ave",
            "",
        ),
        (
            "d63cc1ae-3168-11ea-a9c2-021785291289",
            -83.0445105,
            39.985158,
            "Grandview Ave & 3rd Ave",
            "",
        ),
        (
            "d63b7f96-3168-11ea-a9c2-021785291289",
            -83.0090465,
            39.945884,
            "Scioto Audubon Center",
            "",
        ),
        (
            "d63bf77f-3168-11ea-a9c2-021785291289",
            -82.9868825,
            39.9602635,
            "Topiary Park - Town St",
            "",
        ),
        ("d63bc7f7-3168-11ea-a9c2-021785291289", -83.0064855, 39.96116, "COSI", ""),
        (
            "d63c727c-3168-11ea-a9c2-021785291289",
            -83.020464,
            40.006583,
            "Lane Ave at Olentangy Trail",
            "",
        ),
        (
            "d63c6df7-3168-11ea-a9c2-021785291289",
            -82.9894985,
            39.9446015,
            "Jaeger St & Whittier St",
            "",
        ),
        (
            "d63c8a52-3168-11ea-a9c2-021785291289",
            -82.914337,
            40.037329,
            "Easton Square Pl & Loyalty Circle",
            "",
        ),
        (
            "d63ca61e-3168-11ea-a9c2-021785291289",
            -82.9445055,
            39.971343,
            "Jeffrey Park on Clifton Ave",
            "",
        ),
        (
            "9f00ab91-5b84-482d-af30-0fcf3d4a5d9f",
            -82.9098325,
            40.060836,
            "Easton Transit Center",
            "",
        ),
        (
            "d63ba7e5-3168-11ea-a9c2-021785291289",
            -83.002202,
            39.971255,
            "Convention Center",
            "",
        ),
        (
            "d63cebb8-3168-11ea-a9c2-021785291289",
            -83.013642,
            40.022519,
            "High St & Crestview Rd",
            "",
        ),
        (
            "d63ce736-3168-11ea-a9c2-021785291289",
            -83.0110875,
            40.014607,
            "High St & Hudson St",
            "",
        ),
        (
            "d63cb3fc-3168-11ea-a9c2-021785291289",
            -83.0516705,
            40.0071635,
            "Wellesley Dr & Lane Ave",
            "",
        ),
        (
            "d63c9846-3168-11ea-a9c2-021785291289",
            -82.926169,
            39.9569695,
            "Grandon Ave & Main St",
            "",
        ),
        (
            "dffd4a67-9fc5-4b0f-a3ee-48bc3ff40950",
            -83.0190521478653,
            40.041221957165284,
            "Library - Whetstone Branch",
            "",
        ),
        (
            "d63c52c6-3168-11ea-a9c2-021785291289",
            -83.0071245,
            39.9947255,
            "High St & 11th Ave",
            "",
        ),
        (
            "d63bcc80-3168-11ea-a9c2-021785291289",
            -83.0035705,
            39.9721975,
            "North Market",
            "",
        ),
        (
            "d63cb89d-3168-11ea-a9c2-021785291289",
            -83.0490005,
            39.9967685,
            "North Star Rd & Northwest Blvd",
            "",
        ),
        (
            "d63acb22-3168-11ea-a9c2-021785291289",
            -83.0002435,
            39.950149,
            "Front St & Beck St",
            "",
        ),
        (
            "d63cd99b-3168-11ea-a9c2-021785291289",
            -83.009192,
            40.0063975,
            "High St & Lane Ave",
            "",
        ),
        (
            "d63b8bd0-3168-11ea-a9c2-021785291289",
            -82.9950175,
            39.941996,
            "Schiller Park - Stewart Ave",
            "",
        ),
        (
            "d63cde22-3168-11ea-a9c2-021785291289",
            -83.0011625,
            40.001957,
            "Summit St & 17th Ave",
            "",
        ),
        (
            "ec36822c-f636-4cf6-88e4-f2afd565a02b",
            -83.0191557,
            39.967324,
            "Neiland and Nationwide",
            "",
        ),
        (
            "d63c64f5-3168-11ea-a9c2-021785291289",
            -83.016892,
            39.984092,
            "Michigan Ave & 3rd Ave",
            "",
        ),
        (
            "d63bda4d-3168-11ea-a9c2-021785291289",
            -83.0035065,
            39.977479,
            "High St & Warren",
            "",
        ),
        (
            "d63caac7-3168-11ea-a9c2-021785291289",
            -83.0575055,
            40.0189615,
            "Northwest Blvd and Zollinger Rd",
            "",
        ),
        (
            "d63c409d-3168-11ea-a9c2-021785291289",
            -82.998027,
            39.980568,
            "GO FITNESS IV (Italian Village) 4th/1st",
            "",
        ),
        (
            "d63ce2a2-3168-11ea-a9c2-021785291289",
            -82.989416,
            39.9859055,
            "Cleveland Ave & 4th Ave",
            "",
        ),
        (
            "d63c6069-3168-11ea-a9c2-021785291289",
            -83.013582,
            39.9902415,
            "Neil Ave & King Ave",
            "",
        ),
        (
            "42f01987-2da2-4569-868e-887dd83da3a1",
            -82.98337172716856,
            39.94042266690196,
            "Library - Parsons Branch",
            "",
        ),
        (
            "d63d07de-3168-11ea-a9c2-021785291289",
            -83.0422135,
            39.9935795,
            "Northwest Blvd & Chambers Rd",
            "",
        ),
        (
            "d63ba363-3168-11ea-a9c2-021785291289",
            -83.0040165,
            39.969172,
            "Nationwide Arena - Front St",
            "",
        ),
        (
            "d63b90df-3168-11ea-a9c2-021785291289",
            -83.00851,
            39.9680165,
            "Neil Ave & Nationwide Blvd",
            "",
        ),
        (
            "d63bfc16-3168-11ea-a9c2-021785291289",
            -82.981344,
            39.9632325,
            "Parsons Ave & Oak St",
            "",
        ),
        (
            "d63b958c-3168-11ea-a9c2-021785291289",
            -83.0003495,
            39.9465955,
            "Bank St & Frankfort St",
            "",
        ),
        (
            "d63bb5aa-3168-11ea-a9c2-021785291289",
            -82.9900715,
            39.9575095,
            "Grant Ave & Main St",
            "",
        ),
        (
            "d63ac3a4-3168-11ea-a9c2-021785291289",
            -83.004253,
            39.962989,
            "City Hall",
            "",
        ),
        (
            "d63bc36a-3168-11ea-a9c2-021785291289",
            -82.9986475,
            39.963983,
            "3rd St & Gay St",
            "",
        ),
        (
            "d63c9cd3-3168-11ea-a9c2-021785291289",
            -82.936316,
            39.9553655,
            "Pleasant Ridge Ave & Mound St",
            "",
        ),
        (
            "d63bee51-3168-11ea-a9c2-021785291289",
            -82.9871527,
            39.964532,
            "Columbus Museum of Art",
            "",
        ),
        (
            "d63cbd1e-3168-11ea-a9c2-021785291289",
            -83.0617315,
            39.9988165,
            "Mallway Park at Arlington Ave",
            "",
        ),
        (
            "d63d1a37-3168-11ea-a9c2-021785291289",
            -82.9081665,
            40.055071,
            "Seward St & Worth Ave",
            "",
        ),
        (
            "c6c6199c-32a4-4edf-a46a-967d713a4824",
            -82.9682205,
            40.0128495,
            "Library - Linden Branch",
            "",
        ),
        (
            "d63bb129-3168-11ea-a9c2-021785291289",
            -82.9790935,
            39.951377,
            "Livingston Park",
            "",
        ),
        (
            "d63ccac5-3168-11ea-a9c2-021785291289",
            -83.0258675,
            39.9770195,
            "Yard St & Burr Ave",
            "",
        ),
        (
            "d63c4e3f-3168-11ea-a9c2-021785291289",
            -83.0058285,
            39.9901425,
            "High St & King Ave",
            "",
        ),
        (
            "d63ccf5c-3168-11ea-a9c2-021785291289",
            -83.0326855,
            39.97996,
            "Northwest Blvd & 1st Ave",
            "",
        ),
        (
            "d63bac86-3168-11ea-a9c2-021785291289",
            -83.001122,
            39.962012,
            "High St & Broad St",
            "",
        ),
        (
            "97ff94a7-da2a-4500-989c-c25caa16fac9",
            -82.98883236944674,
            39.93589714085142,
            "Moeller Park at Bruck St",
            "",
        ),
        (
            "5d3f1dda-ec98-4749-a5a7-cc5048a851ef",
            -82.97900676727295,
            39.97110065411914,
            "King Arts Complex",
            "",
        ),
        (
            "d63d15a9-3168-11ea-a9c2-021785291289",
            -82.9116552,
            40.0535477,
            "Brighton Rose & Worth Ave",
            "",
        ),
        (
            "d63c3c09-3168-11ea-a9c2-021785291289",
            -82.9691835,
            39.957748,
            "Champion Ave & Main St",
            "",
        ),
        (
            "d63c8f1d-3168-11ea-a9c2-021785291289",
            -82.910212,
            40.0566725,
            "Stelzer Rd & Morse Rd",
            "",
        ),
        (
            "d63cd4d0-3168-11ea-a9c2-021785291289",
            -83.001959,
            39.9590745,
            "Front St & Town St",
            "",
        ),
        (
            "d63c8022-3168-11ea-a9c2-021785291289",
            -82.9063305,
            40.0445335,
            "Easton Oval",
            "",
        ),
        (
            "d63d1110-3168-11ea-a9c2-021785291289",
            -82.9152355,
            40.0488005,
            "Easton Square Pl & Townsfair Way",
            "",
        ),
        (
            "d63c770b-3168-11ea-a9c2-021785291289",
            -82.987683,
            39.9396375,
            "Thurman Ave & Bruck St",
            "",
        ),
        (
            "d63c857f-3168-11ea-a9c2-021785291289",
            -82.9104665,
            40.047495,
            "Stelzer & Easton Way",
            "",
        ),
        (
            "d63ca195-3168-11ea-a9c2-021785291289",
            -82.940239,
            39.957385,
            "Bexley City Hall at Main St",
            "",
        ),
        (
            "d63bd118-3168-11ea-a9c2-021785291289",
            -83.0075375,
            39.97125,
            "Kilbourne St & Vine St",
            "",
        ),
        (
            "c5c08bb4-aff8-4215-a694-b9a7b1641b31",
            -83.02459560334682,
            39.95896543121186,
            "Broad St & Martin Ave",
            "",
        ),
        (
            "d63c3782-3168-11ea-a9c2-021785291289",
            -83.01138,
            39.9574,
            "Lucas St & Town St",
            "",
        ),
        (
            "d63c6977-3168-11ea-a9c2-021785291289",
            -82.9954235,
            39.9577005,
            "4th St & Rich St",
            "",
        ),
        (
            "d63c5be3-3168-11ea-a9c2-021785291289",
            -83.014305,
            39.9940515,
            "Neil Ave & 10th Ave",
            "",
        ),
        (
            "d63c4527-3168-11ea-a9c2-021785291289",
            -83.0054595,
            39.985221,
            "High St & 4th Ave",
            "",
        ),
        (
            "d6ee1ec4-b838-464f-acca-8968b0b2671e",
            -82.9682765,
            40.00075,
            "St. Stephen's Community House",
            "",
        ),
        (
            "1347067b-332c-4291-89c9-948813957304",
            -82.9811075,
            39.99355,
            "Linden Transit Center",
            "",
        ),
        (
            "d63c7b8b-3168-11ea-a9c2-021785291289",
            -83.027448,
            39.985822,
            "Market District & 3rd Ave",
            "",
        ),
        (
            "d63c49b8-3168-11ea-a9c2-021785291289",
            -82.999556,
            39.9887625,
            "Weinland Park - 6th Ave",
            "",
        ),
        (
            "d63bba47-3168-11ea-a9c2-021785291289",
            -83.001614,
            39.9685285,
            "Sensenbrenner Park",
            "",
        ),
        (
            "d63be41b-3168-11ea-a9c2-021785291289",
            -82.9908015,
            39.969191,
            "Cleveland Ave & Mt Vernon Ave",
            "",
        ),
        (
            "d63d0c70-3168-11ea-a9c2-021785291289",
            -83.009456,
            39.9869065,
            "Thompson Park at Hunter Ave",
            "",
        ),
        (
            "d63cc63d-3168-11ea-a9c2-021785291289",
            -83.0489765,
            39.9819315,
            "Grandview Library at Oakland Ave",
            "",
        ),
        (
            "1527221109859631254",
            -83.0041135,
            39.9567944,
            "Bicentennial Public Rack",
            "Milestone 229, 229, South Civic Center Drive, River South, Columbus, Franklin County, Ohio, 43215, United States",
        ),
        (
            "1475694115961709530",
            -83.004018,
            39.980002,
            "High & Prescott",
            "Arch City Tavern, 862, North High Street, Italian Village, Columbus, Franklin County, Ohio, 43215, United States of America",
        ),
        (
            "1475694107371774928",
            -83.003107,
            39.975462,
            "High & Russell",
            "Brandt-Roberts Gallery, 642, North High Street, Italian Village, Columbus, Franklin County, Ohio, 43215, United States of America",
        ),
        (
            "1475694115961709532",
            -83.004433,
            39.980953,
            "High & Price/First",
            "921, North High Street, Italian Village, Columbus, Franklin County, Ohio, 43201, United States of America",
        ),
        (
            "1475697167647006232",
            -83.007939,
            39.997555,
            "Ohio State Student Union",
            "Ohio Union, 1739, North High Street, Indianola Terrace, Columbus, Franklin County, Ohio, 43210, United States of America",
        ),
        (
            "1475694111666742228",
            -83.003368,
            39.976781,
            "High & Lincoln",
            "CoGo High St and Lincoln St, East Lincoln Street, Italian Village, Columbus, Franklin County, Ohio, 43215-1430, United States of America",
        ),
        (
            "1475694111666742232",
            -83.003787,
            39.978914,
            "High & Hubbard",
            "Moxy, 810, North High Street, Italian Village, Columbus, Franklin County, Ohio, 43215, United States of America",
        ),
    ]

    def test_read_free_bikes(self):
        free_bikes = main.read_enabled_free_bikes("tests_data/free_bike_status.json")
        assert free_bikes == self.exemple_free_bikes

    def test_next_free_bikes(self):
        next_bikes = main.get_next_free_bikes(Path("tests_data/history"))
        assert next_bikes == self.exemple_free_bikes

    def test_read_stations(self):
        p = Path("tests_data/station_information.json")
        with p.open() as f:
            stations = main.iter_stations(f.read())
        assert list(stations) == self.example_stations


if __name__ == "__main__":
    unittest.main()
